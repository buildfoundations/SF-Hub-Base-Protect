-- [[ SF HUB BASE PROTECT - V11.2 ]] --



local GIST_ID = "02bbd68968c36e30ddc57102390eb89c"

local DISCORD_LINK = "discord.gg/3GqZKqZS"

local databaseURL = "https://gist.githubusercontent.com/buildfoundations/"..GIST_ID.."/raw/database.lua?t="..tick()

local plotKey = "78a772b6-9e1c-4827-ab8b-04a07838f298"



local Players = game:GetService("Players")

local localPlayer = Players.LocalPlayer

local Workspace = game:GetService("Workspace")

local RunService = game:GetService("RunService")

local ReplicatedStorage = game:GetService("ReplicatedStorage")

local netPath = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/352aad58-c786-4998-886b-3e4fa390721e")



local userKeyFile = "SF_AccessKey.txt"

local activeMode = "None"

local fullCombo = {"ragdoll", "rocket", "jail", "balloon", "inverse", "tiny", "jumpscare", "morph"}

local lastStealTime = 0

local isFirstOffense = true

local currentHitbox = nil



local BG_COLOR = Color3.fromRGB(13, 13, 17)

local ACCENT_COLOR = Color3.fromRGB(80, 80, 255)

local TEXT_COLOR = Color3.fromRGB(255, 255, 255)

local statusLbl



-- [[ UTILS ]] --

local function clean(str) return tostring(str):gsub("^%s*(.-)%s*$", "%1"):lower() end



local function findMyHitbox()

    local plots = Workspace:FindFirstChild("Plots")

    if not plots then return nil end

    local closestDist, found = math.huge, nil

    for _, plot in ipairs(plots:GetChildren()) do

        local hb = plot:FindFirstChild("StealHitbox", true)

        if hb and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then

            local dist = (localPlayer.Character.HumanoidRootPart.Position - hb.Position).Magnitude

            if dist < closestDist then closestDist = dist found = hb end

        end

    end

    return found

end



-- [[ DEFENSE LOGIC - UNTOUCHED ]] --

local function executePunish(thief)

    if not thief or (tick() - lastStealTime < 3) then return end

    lastStealTime = tick()

    

    statusLbl.Text = "PUNISHING: " .. thief.Name:upper()

    statusLbl.TextColor3 = Color3.fromRGB(255, 50, 50)

    

    local modeAtTimeOfDetection = activeMode 

    

    task.spawn(function()

        if isFirstOffense then

            netPath:FireServer(plotKey, thief, "balloon")

            task.wait(0.1)

            netPath:FireServer(plotKey, thief, "jail")

            isFirstOffense = false

        else

            for _, attack in ipairs(fullCombo) do

                netPath:FireServer(plotKey, thief, attack)

                task.wait(0.05)

            end

        end

        

        if modeAtTimeOfDetection == "Kick" then

            task.wait(0.5)

            localPlayer:Kick("\nðŸ›¡ï¸ SF Hub: Theft Blocked\nJoin for script: " .. DISCORD_LINK)

        end

    end)

end



local lastScanTime = 0

RunService.Heartbeat:Connect(function()

    if activeMode == "None" then

        if statusLbl then statusLbl.Text = "STATUS: IDLE" statusLbl.TextColor3 = Color3.fromRGB(150, 150, 150) end

        return

    end



    -- Optimization: Runs detection 20 times per second (0.05) to balance FPS and Speed

    if tick() - lastScanTime < 0.05 then return end

    lastScanTime = tick()



    if activeMode == "Protector" then

        if not currentHitbox then currentHitbox = findMyHitbox() end

        if currentHitbox then

            statusLbl.Text = "STATUS: MONITORING BORDERS"

            statusLbl.TextColor3 = Color3.fromRGB(0, 180, 255)

            local cf, size = currentHitbox.CFrame, currentHitbox.Size

            for _, player in ipairs(Players:GetPlayers()) do

                if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then

                    local rel = cf:PointToObjectSpace(player.Character.HumanoidRootPart.Position)

                    if math.abs(rel.X) <= (size.X/2) and math.abs(rel.Z) <= (size.Z/2) then

                        localPlayer:Kick("\nðŸ›¡ï¸ SF Protector: " .. player.Name .. " entered base!\nJoin for script: " .. DISCORD_LINK)

                    end

                end

            end

        end

    end



    if (activeMode == "Kick" or activeMode == "NoKick") then

        statusLbl.Text = "STATUS: MONITORING TAGS"

        statusLbl.TextColor3 = Color3.fromRGB(0, 255, 150)

        

        for _, item in ipairs(Workspace:GetDescendants()) do

            if item.Name == "Stolen" and item:IsA("GuiObject") and item.Visible then

                local rootPart = item:FindFirstAncestor("RootPart") or item.Parent:FindFirstAncestorOfClass("Part")

                if rootPart then

                    local closestThief = nil

                    local shortestDist = 15

                    for _, player in ipairs(Players:GetPlayers()) do

                        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then

                            local dist = (player.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude

                            if dist < shortestDist then

                                shortestDist = dist

                                closestThief = player

                            end

                        end

                    end

                    if closestThief then executePunish(closestThief) break end

                end

            end

        end

    end

end)



-- [[ UI ENGINE ]] --

local function loadMainHub(expiryStr)

    local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))

    sg.Name = "SF_PremiumHub"



    local main = Instance.new("Frame", sg)

    main.Size, main.Position = UDim2.new(0, 330, 0, 360), UDim2.new(0.5, -165, 0.4, 0)

    main.BackgroundColor3, main.Active, main.Draggable = BG_COLOR, true, true

    Instance.new("UICorner", main)

    main.ClipsDescendants = true

    

    local rgbS = Instance.new("UIStroke", main) 

    rgbS.Thickness = 2

    task.spawn(function() while task.wait() do rgbS.Color = Color3.fromHSV(tick() % 5 / 5, 0.8, 1) end end)



    local titleBar = Instance.new("Frame", main)

    titleBar.Size, titleBar.BackgroundColor3 = UDim2.new(1, 0, 0, 55), Color3.fromRGB(18, 18, 22)

    Instance.new("UICorner", titleBar)



    local titleLbl = Instance.new("TextLabel", titleBar)

    titleLbl.Size, titleLbl.Position = UDim2.new(0, 200, 0, 25), UDim2.new(0, 15, 0, 8)

    titleLbl.Text, titleLbl.TextColor3, titleLbl.Font, titleLbl.TextSize, titleLbl.BackgroundTransparency = "SF HUB BASE PROTECT", TEXT_COLOR, Enum.Font.GothamBold, 13, 1

    titleLbl.TextXAlignment = Enum.TextXAlignment.Left



    statusLbl = Instance.new("TextLabel", titleBar)

    statusLbl.Size, statusLbl.Position = UDim2.new(0, 250, 0, 20), UDim2.new(0, 15, 0, 28)

    statusLbl.Text, statusLbl.TextColor3, statusLbl.Font, statusLbl.TextSize, statusLbl.BackgroundTransparency = "STATUS: IDLE", Color3.fromRGB(150, 150, 150), Enum.Font.GothamBold, 9, 1

    statusLbl.TextXAlignment = Enum.TextXAlignment.Left



    -- FOOTER

    local footer = Instance.new("Frame", main)

    footer.Size, footer.Position, footer.BackgroundColor3 = UDim2.new(1, 0, 0, 60), UDim2.new(0, 0, 1, -60), Color3.fromRGB(10, 10, 15)

    

    local expLbl = Instance.new("TextLabel", footer)

    expLbl.Size, expLbl.Position, expLbl.BackgroundTransparency, expLbl.TextColor3 = UDim2.new(0.5, -15, 1, 0), UDim2.new(0, 15, 0, 0), 1, Color3.fromRGB(255, 255, 255)

    expLbl.Font, expLbl.TextSize, expLbl.TextXAlignment = Enum.Font.GothamBold, 13, "Left"

    expLbl.Text = "EXPIRY: " .. tostring(expiryStr)



    local discordLbl = Instance.new("TextLabel", footer)

    discordLbl.Size, discordLbl.Position, discordLbl.BackgroundTransparency, discordLbl.TextColor3 = UDim2.new(0.5, -15, 1, 0), UDim2.new(0.5, 0, 0, 0), 1, ACCENT_COLOR

    discordLbl.Font, discordLbl.TextSize, discordLbl.TextXAlignment = Enum.Font.GothamBold, 13, "Right"

    discordLbl.Text = DISCORD_LINK



    local contentFrame = Instance.new("Frame", main)

    contentFrame.Size, contentFrame.Position, contentFrame.BackgroundTransparency = UDim2.new(1, 0, 1, -115), UDim2.new(0, 0, 0, 55), 1



    local function createModeToggle(text, yOffset, modeID)

        local row = Instance.new("Frame", contentFrame)

        row.Size, row.Position = UDim2.new(0.92, 0, 0, 45), UDim2.new(0.04, 0, 0, 10 + yOffset)

        row.BackgroundColor3 = Color3.fromRGB(20, 20, 25)

        Instance.new("UICorner", row)

        

        local btn = Instance.new("TextButton", row)

        btn.Size, btn.Position, btn.BackgroundColor3, btn.Text = UDim2.new(0, 75, 0, 30), UDim2.new(0.95, -75, 0.5, -15), Color3.fromRGB(40, 40, 50), "OFF"

        btn.TextColor3, btn.Font, btn.TextSize = TEXT_COLOR, Enum.Font.GothamBold, 10

        Instance.new("UICorner", btn)

        

        local lbl = Instance.new("TextLabel", row)

        lbl.Size, lbl.Position, lbl.Text, lbl.Font, lbl.TextColor3 = UDim2.new(0.7, 0, 1, 0), UDim2.new(0, 15, 0, 0), text, Enum.Font.GothamBold, Color3.fromRGB(200, 200, 200)

        lbl.TextSize, lbl.TextXAlignment, lbl.BackgroundTransparency = 10, "Left", 1

        

        btn.MouseButton1Click:Connect(function()

            activeMode = (activeMode == modeID) and "None" or modeID

            for _, v in ipairs(contentFrame:GetChildren()) do

                if v:IsA("Frame") and v:FindFirstChild("TextButton") then

                    v.TextButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50)

                    v.TextButton.Text = "OFF"

                end

            end

            if activeMode == modeID then btn.BackgroundColor3, btn.Text = ACCENT_COLOR, "ACTIVE" end

        end)

    end



    createModeToggle("BASE PROTECTOR (BORDER KICK)", 0, "Protector")

    createModeToggle("AP SPAM ON STEAL (KICK)", 50, "Kick")

    createModeToggle("AP SPAM ON STEAL (NO KICK)", 100, "NoKick")



    local logoutBtn = Instance.new("TextButton", contentFrame)

    logoutBtn.Size, logoutBtn.Position, logoutBtn.BackgroundColor3 = UDim2.new(0.92, 0, 0, 40), UDim2.new(0.04, 0, 0, 165), Color3.fromRGB(200, 60, 60)

    logoutBtn.Text, logoutBtn.TextColor3, logoutBtn.Font, logoutBtn.TextSize = "LOGOUT (RESET KEY)", TEXT_COLOR, Enum.Font.GothamBold, 11

    Instance.new("UICorner", logoutBtn)

    logoutBtn.MouseButton1Click:Connect(function() if isfile(userKeyFile) then delfile(userKeyFile) end sg:Destroy() end)



    local minBtn = Instance.new("TextButton", titleBar)

    minBtn.Size, minBtn.Position, minBtn.BackgroundColor3, minBtn.Text = UDim2.new(0, 35, 0, 35), UDim2.new(1, -85, 0.5, -17), Color3.fromRGB(35, 35, 45), "-"

    minBtn.TextColor3, minBtn.Font, minBtn.TextSize = TEXT_COLOR, Enum.Font.GothamBold, 20

    Instance.new("UICorner", minBtn)



    local closeBtn = Instance.new("TextButton", titleBar)

    closeBtn.Size, closeBtn.Position, closeBtn.BackgroundColor3, closeBtn.Text = UDim2.new(0, 35, 0, 35), UDim2.new(1, -45, 0.5, -17), Color3.fromRGB(200, 60, 60), "Ã—"

    closeBtn.TextColor3, closeBtn.Font, closeBtn.TextSize = TEXT_COLOR, Enum.Font.GothamBold, 22

    Instance.new("UICorner", closeBtn)



    local isMin = false

    minBtn.MouseButton1Click:Connect(function()

        isMin = not isMin

        contentFrame.Visible, footer.Visible = not isMin, not isMin

        main:TweenSize(isMin and UDim2.new(0, 330, 0, 55) or UDim2.new(0, 330, 0, 360), "Out", "Quart", 0.3, true)

        minBtn.Text = isMin and "+" or "-"

    end)

    closeBtn.MouseButton1Click:Connect(function() sg:Destroy() end)

end



-- [[ LOGIN LOGIC ]] --

local function startLogin()

    local success, response = pcall(function() return game:HttpGet(databaseURL) end)

    if not success then return end

    local db = loadstring(response)()

    local k = isfile(userKeyFile) and clean(readfile(userKeyFile)) or ""

    

    local keyData = db[k]

    

    if keyData then

        local expiryTimestamp = tonumber(keyData[1]) or 0

        local currentTime = os.time()

        

        if expiryTimestamp > 2000000000 then

            loadMainHub("PERMANENT")

        elseif currentTime < expiryTimestamp then

            local timeLeft = expiryTimestamp - currentTime

            local expiryString = ""



            if timeLeft >= 86400 then

                expiryString = math.floor(timeLeft / 86400) .. " DAYS"

            elseif timeLeft >= 3600 then

                expiryString = math.floor(timeLeft / 3600) .. " HOURS"

            else

                expiryString = math.floor(timeLeft / 60) .. " MINS"

            end



            loadMainHub(expiryString)

        else

            if isfile(userKeyFile) then delfile(userKeyFile) end

            k = ""

        end

    end



    if not keyData or k == "" then

        local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))

        sg.Name = "SF_LoginUI"



        local login = Instance.new("Frame", sg)

        login.Size, login.Position, login.BackgroundColor3 = UDim2.new(0, 320, 0, 250), UDim2.new(0.5, -160, 0.4, 0), BG_COLOR

        Instance.new("UICorner", login)

        Instance.new("UIStroke", login).Color = ACCENT_COLOR



        local loginTitle = Instance.new("TextLabel", login)

        loginTitle.Size, loginTitle.Position = UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 10)

        loginTitle.Text, loginTitle.TextColor3, loginTitle.Font, loginTitle.TextSize, loginTitle.BackgroundTransparency = "SF HUB: ACCESS KEY", TEXT_COLOR, Enum.Font.GothamBold, 16, 1



        local input = Instance.new("TextBox", login)

        input.Size, input.Position, input.PlaceholderText = UDim2.new(0.85, 0, 0, 40), UDim2.new(0.075, 0, 0, 65), "ENTER KEY HERE..."

        input.BackgroundColor3, input.TextColor3, input.Font, input.TextSize = Color3.fromRGB(20, 20, 25), TEXT_COLOR, Enum.Font.GothamBold, 12

        Instance.new("UICorner", input)

        Instance.new("UIStroke", input).Color = Color3.fromRGB(40, 40, 45)



        local btn = Instance.new("TextButton", login)

        btn.Size, btn.Position, btn.Text, btn.BackgroundColor3 = UDim2.new(0.85, 0, 0, 45), UDim2.new(0.075, 0, 0, 120), "ACTIVATE SCRIPT", ACCENT_COLOR

        btn.TextColor3, btn.Font, btn.TextSize = TEXT_COLOR, Enum.Font.GothamBold, 14

        Instance.new("UICorner", btn)



        local getBtn = Instance.new("TextButton", login)

        getBtn.Size, getBtn.Position, getBtn.Text, getBtn.BackgroundColor3 = UDim2.new(0.85, 0, 0, 40), UDim2.new(0.075, 0, 0, 175), "GET KEY / DISCORD", Color3.fromRGB(30, 30, 35)

        getBtn.TextColor3, getBtn.Font, getBtn.TextSize = Color3.fromRGB(180, 180, 180), Enum.Font.GothamBold, 12

        Instance.new("UICorner", getBtn)

        Instance.new("UIStroke", getBtn).Color = Color3.fromRGB(50, 50, 55)



        btn.MouseButton1Click:Connect(function() 

            writefile(userKeyFile, clean(input.Text)) 

            sg:Destroy() 

            startLogin() 

        end)



        getBtn.MouseButton1Click:Connect(function()

            setclipboard(DISCORD_LINK)

            getBtn.Text = "COPIED!"

            task.wait(2)

            getBtn.Text = "GET KEY / DISCORD"

        end)

    end

end

startLogin()

